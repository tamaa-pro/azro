<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قائمة التطبيقات</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" href="https://k.top4top.io/p_35326d4d31.jpg" type="image/png">
<style>
:root{--bg-primary:#121212;--bg-secondary:#1e1e1e;--bg-tertiary:#1c1c1c;--text-primary:#e0e0e0;--text-secondary:#a0a0a0;--accent:#4CAF50;--accent-hover:#3e8e41}
body{background:var(--bg-primary);color:var(--text-primary);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:0;padding:10px}
.container{max-width:900px;margin:auto;display:flex;flex-direction:column;gap:20px}
.navbar{background:var(--bg-secondary);border-radius:10px;padding:10px;display:flex;align-items:center;gap:10px;margin-bottom:20px}
.search-container{display:flex;align-items:center;flex-grow:1;max-width:300px}
.search-input{background:var(--bg-tertiary);border:none;padding:10px 15px;color:var(--text-primary);border-radius:8px;width:100%;outline:none}
.nav-button{background:var(--bg-tertiary);color:var(--text-primary);border:none;width:42px;height:42px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .3s}
.nav-button:hover{background:#2a2a2a}
.nav-button.active{background:var(--accent);color:white}
.nav-button.add-app{background:var(--accent);color:white}
.nav-button.add-app:hover{background:var(--accent-hover)}
.card{background:var(--bg-secondary);border-radius:10px;padding:10px;cursor:pointer;transition:background .3s;margin-bottom:15px}
.card:hover{background:#2a2a2a}
.card-top{display:flex;align-items:center;gap:15px;margin-bottom:10px}
.card-top img{width:64px;height:64px;border-radius:12px;object-fit:cover;border:2px solid var(--bg-tertiary)}
.card-info h2{margin:0;font-size:18px;color:var(--accent)}
.card-info p{margin:3px 0 0 0;font-size:14px;color:var(--text-secondary)}
.card-desc{background:var(--bg-tertiary);padding:10px;border-radius:8px;font-size:14px;color:var(--text-primary);margin-bottom:8px}
.card-date{font-size:12px;color:var(--text-secondary)}
.footer{text-align:center;margin-top:40px;padding:15px;color:var(--text-secondary);font-size:14px}

/* Skeleton loading */
.skeleton{position:relative;overflow:hidden;background-color:#2a2a2a;border-radius:8px}
.skeleton::after{content:"";position:absolute;top:0;left:-150px;height:100%;width:150px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);animation:shimmer 1.2s infinite}
@keyframes shimmer{100%{transform:translateX(100%)}}
.skeleton-card{background:var(--bg-secondary);border-radius:10px;padding:10px;margin-bottom:15px}
.skeleton-line{height:12px;width:100%;margin:8px 5px}
.skeleton-img{width:64px;height:64px;border-radius:12px;margin-right:2px;flex-shrink:0}
.skeleton-top{display:flex;align-items:center;margin-bottom:10px}
</style>
</head>
<body>
<div class="container">
    <div class="navbar">
        <input type="text" class="search-input" id="searchInput" placeholder="ابحث عن تطبيق...">
        <button class="nav-button" id="sortButton" title="عكس ترتيب التطبيقات"><i class="fas fa-sort-amount-down"></i></button>
        <button class="nav-button add-app" id="addAppButton" title="إضافة تطبيق جديد"><i class="fas fa-plus"></i></button>
    </div>
    <div id="appsList"></div>
</div>
<div class="footer">Powered by TAMAA PRO STUDIO</div>

<script>
const jsonBinUrl="https://api.jsonbin.io/v3/b/68b5a02ed0ea881f406e0b94";
const apiKey="$2a$10$F5TR7pSKPRRNAeBzsdxQ4.NYog8xHGUi0hektkor0q/QWFVXzba3q";
let allApps=[];let isNewestFirst=true;

function showSkeletons(){
let skeletonHTML="";
for(let i=0;i<5;i++){
skeletonHTML+=`
<div class="skeleton-card">
  <div class="skeleton-top">
    <div class="skeleton skeleton-img"></div>
    <div style="flex:1">
      <div class="skeleton skeleton-line" style="width:60%;height:16px"></div>
      <div class="skeleton skeleton-line" style="width:40%"></div>
    </div>
  </div>
  <div class="skeleton skeleton-line" style="width:90%"></div>
  <div class="skeleton skeleton-line" style="width:50%"></div>
</div>`;
}
document.getElementById("appsList").innerHTML=skeletonHTML;
}

async function fetchApps(){const res=await fetch(jsonBinUrl,{headers:{"X-Master-Key":apiKey}});return res.json();}

async function loadApps(){
showSkeletons();
try{
const data=await fetchApps();
allApps=data.record.applications;
if(!allApps||allApps.length===0){
document.getElementById("appsList").innerHTML="<p>لا توجد تطبيقات مرفوعة حاليا</p>";
return;
}
renderApps();
}catch(e){
document.getElementById("appsList").innerHTML="<p>❌ خطأ في تحميل التطبيقات</p>";
}
}

function renderApps(){
const sorted=[...allApps].sort((a,b)=>{
const da=new Date(a.uploadDate);
const db=new Date(b.uploadDate);
return isNewestFirst?db-da:da-db;
});
const search=document.getElementById("searchInput").value.toLowerCase();
const filtered=sorted.filter(app=>app.name.toLowerCase().includes(search)||app.developer.toLowerCase().includes(search)||app.shortDesc.toLowerCase().includes(search));
if(filtered.length===0){document.getElementById("appsList").innerHTML="<p>لا توجد تطبيقات تطابق بحثك</p>";return;}
const html=filtered.map(app=>`
<div class="card" onclick="openApp('${app.package}')">
  <div class="card-top">
    <img src="${app.icon}" alt="icon">
    <div class="card-info">
      <h2>${app.name}</h2>
      <p>${app.developer}</p>
    </div>
  </div>
  <div class="card-desc">${app.shortDesc}</div>
  <div class="card-date">تاريخ الرفع: ${app.uploadDate}</div>
</div>`).join("");
document.getElementById("appsList").innerHTML=html;
}

function openApp(pkg){window.location.href=`https://tamaa-pro.github.io/azro/tazazt/download_app/?${pkg}`;}
document.getElementById('sortButton').addEventListener('click',function(){
isNewestFirst=!isNewestFirst;
this.innerHTML=isNewestFirst?'<i class="fas fa-sort-amount-down"></i>':'<i class="fas fa-sort-amount-up"></i>';
renderApps();
});
document.getElementById('searchInput').addEventListener('input',renderApps);
document.getElementById('addAppButton').addEventListener('click',()=>{window.location.href="https://tamaa-pro.github.io/azro/tazazt/upload_app";});
loadApps();
</script>

<script>
document.addEventListener('wheel',e=>{if(e.ctrlKey)e.preventDefault()},{passive:false});
document.addEventListener('keydown',e=>{if((e.ctrlKey&&(e.key==='+'||e.key==='-'||e.key==='='))||e.key==='Meta')e.preventDefault()});
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('selectstart',e=>e.preventDefault());
document.addEventListener('copy',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&(e.key==='+'||e.key==='-'||e.key==='0'||e.keyCode===187||e.keyCode===189||e.keyCode===48))e.preventDefault()});
document.addEventListener('wheel',e=>{if(e.ctrlKey)e.preventDefault()},{passive:false});
let lastTouchEnd=0;
document.addEventListener('touchstart',e=>{if(e.touches.length>1)e.preventDefault()});
document.addEventListener('touchend',e=>{const now=Date.now();if(now-lastTouchEnd<=300)e.preventDefault();lastTouchEnd=now},{passive:false});
document.addEventListener('touchmove',e=>{if(e.touches.length>1)e.preventDefault()},{passive:false});
document.addEventListener('dblclick',e=>e.preventDefault(),{passive:false});
const v=document.querySelector('meta[name="viewport"]');
v.content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
</script>
</body>
</html>
