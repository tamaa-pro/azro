<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box}

html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
}

#toolbar{
    position:fixed;
    top:0;left:0;right:0;
    height:48px;
    background:#111;
    display:flex;
    align-items:center;
    gap:10px;
    padding:0 8px;
    z-index:10;
}

#toolbar button{
    background:none;
    border:none;
    color:#fff;
    font-size:16px;
    cursor:pointer;
}

#editor,
#viewer{
    position:fixed;
    top:48px;left:0;right:0;bottom:0;
    border:none;
    outline:none;
    resize:none;
    padding:3px;
    font-size:15px;
    font-family:inherit;
    background:#000;
    color:#fff;
}

#viewer{display:none}

#overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    backdrop-filter:blur(6px);
    display:none;
    z-index:20;
}

#settingsBox{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#222;
    width:300px;
    padding:12px;
    display:none;
    z-index:30;
}

#settingsBox header button{
    background:none;
    border:none;
    color:#fff;
    font-size:16px;
}

.divider{
    height:1px;
    background:#333;
    margin:10px 0;
}

.setting{margin-bottom:8px}

.setting label,
.section-title{
    display:block;
    color:#aaa;
    font-size:12px;
    margin-bottom:4px;
}

.setting input,
.setting select{
    width:100%;
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:6px;
    font-size:13px;
}

.btn{
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:7px;
    font-size:13px;
    cursor:pointer;
}

.btn:hover{background:#191919}

.row{
    display:flex;
    gap:6px;
}

.row .btn{flex:1}

.hidden{display:none}
</style>
</head>

<body>

<div id="toolbar">
    <button onclick="copyText()"><i class="fa-solid fa-copy"></i></button>
    <button onclick="cutText()"><i class="fa-solid fa-scissors"></i></button>
    <button onclick="pasteText()"><i class="fa-solid fa-paste"></i></button>
    <button onclick="clearAll()"><i class="fa-solid fa-trash"></i></button>
    <button onclick="undo()"><i class="fa-solid fa-rotate-left"></i></button>
    <button onclick="redo()"><i class="fa-solid fa-rotate-right"></i></button>
    <button onclick="goStart()"><i class="fa-solid fa-angles-up"></i></button>
    <button onclick="goEnd()"><i class="fa-solid fa-angles-down"></i></button>
    <button onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
</div>

<textarea id="editor"></textarea>
<iframe id="viewer"></iframe>

<div id="overlay"></div>

<div id="settingsBox">
<header>
    <button onclick="closeSettings()"><i class="fa-solid fa-xmark"></i></button>
</header>

<!-- خيارات الكود -->
<div class="setting">
    <label>اسم الملف</label>
    <input id="fileName" value="index.html">
</div>

<div class="row">
    <button class="btn" onclick="exportCode()">تصدير ملف</button>
    <button class="btn" onclick="fileInput.click()">استيراد ملف</button>
</div>
<input id="fileInput" type="file" class="hidden">

<div class="setting">
    <label>رابط الملف</label>
    <input id="fileUrl">
</div>
<button class="btn" onclick="importFromUrl()">استيراد من رابط</button>

<div class="setting">
    <span class="section-title">تشغيل الكود</span>
</div>

<div class="row">
    <button id="runExternalBtn" class="btn" onclick="toggleExternal()">تشغيل خارجيًا</button>
    <button id="runInternalBtn" class="btn" onclick="toggleInternal()">تشغيل داخليًا</button>
</div>

<div class="divider"></div>

<!-- تخصيص الشكل -->
<div class="setting">
    <label>لون النص</label>
    <input id="textColor">
</div>
<div class="setting">
    <label>لون الخلفية</label>
    <input id="bgColor">
</div>
<div class="setting">
    <label>حجم الخط</label>
    <input id="fontSize">
</div>
<div class="setting">
    <label>نوع الخط</label>
    <select id="fontFamily">
        <option value="inherit">عادي</option>
        <option value="monospace">Monospace</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Verdana">Verdana</option>
        <option value="Courier New">Courier</option>
        <option value="Times New Roman">Times</option>
        <option value="Georgia">Georgia</option>
        <option value="Segoe UI">Segoe UI</option>
        <option value="sans-serif">Sans</option>
    </select>
</div>
</div>

<script>
const editor=document.getElementById("editor");
const viewer=document.getElementById("viewer");

let externalRunning=false;
let internalRunning=false;

/* تشغيل خارجي */
function toggleExternal(){
    if(externalRunning){
        viewer.style.display="none";
        editor.style.display="block";
        externalRunning=false;
        runExternalBtn.textContent="تشغيل خارجيًا";
        return;
    }
    viewer.srcdoc=editor.value;
    viewer.style.display="block";
    editor.style.display="none";
    externalRunning=true;
    runExternalBtn.textContent="إيقاف العرض";
    internalRunning=false;
    runInternalBtn.textContent="تشغيل داخليًا";
}

/* تشغيل داخلي */
function toggleInternal(){
    if(internalRunning){
        editor.style.display="block";
        viewer.style.display="none";
        internalRunning=false;
        runInternalBtn.textContent="تشغيل داخليًا";
        return;
    }
    viewer.srcdoc=editor.value;
    viewer.style.display="block";
    editor.style.display="none";
    internalRunning=true;
    runInternalBtn.textContent="إيقاف العرض";
    externalRunning=false;
    runExternalBtn.textContent="تشغيل خارجيًا";
}

/* باقي الأدوات دون تغيير */
function openSettings(){overlay.style.display="block";settingsBox.style.display="block"}
function closeSettings(){overlay.style.display="none";settingsBox.style.display="none"}
function copyText(){navigator.clipboard.writeText(editor.value)}
function cutText(){navigator.clipboard.writeText(editor.value);editor.value=""}
function pasteText(){document.execCommand("paste")}
function clearAll(){editor.value=""}
function undo(){document.execCommand("undo")}
function redo(){document.execCommand("redo")}
function goStart(){editor.setSelectionRange(0,0)}
function goEnd(){editor.setSelectionRange(editor.value.length,editor.value.length)}

function exportCode(){
    const b=new Blob([editor.value],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(b);
    a.download=fileName.value||"index.html";
    a.click();
}

fileInput.onchange=()=>{
    const r=new FileReader();
    r.onload=e=>editor.value=e.target.result;
    r.readAsText(fileInput.files[0]);
};

function importFromUrl(){
    fetch(fileUrl.value).then(r=>r.text()).then(t=>editor.value=t);
}
</script>

</body>
</html>
