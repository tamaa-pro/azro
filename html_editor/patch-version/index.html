<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box}

html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,Arial,sans-serif;
}

/* الشريط */
#toolbar{
    position:fixed;
    top:0;left:0;right:0;
    height:48px;
    background:#111;
    display:flex;
    align-items:center;
    gap:10px;
    padding:0 8px;
    z-index:10;
}

#toolbar button{
    background:none;
    border:none;
    color:#fff;
    font-size:16px;
    cursor:pointer;
}

/* المحرر */
#editor{
    position:fixed;
    top:48px;left:0;right:0;bottom:0;
    background:#000;
    color:#fff;
    border:none;
    outline:none;
    resize:none;
    padding:3px;
    font-size:15px;
    font-family:inherit;
    direction:ltr;
    white-space:pre-wrap;
    word-wrap:break-word;
    overflow:auto;
}

/* التضبيب */
#overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    backdrop-filter:blur(6px);
    display:none;
    z-index:20;
}

/* نافذة الإعدادات */
#settingsBox{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#222;
    width:300px;
    padding:12px;
    display:none;
    z-index:30;
}

#settingsBox header{
    margin-bottom:8px;
}

#settingsBox header button{
    background:none;
    border:none;
    color:#fff;
    font-size:16px;
}

/* الفاصل */
.divider{
    height:1px;
    background:#333;
    margin:10px 0;
}

/* الحقول */
.setting{margin-bottom:8px}

.setting label{
    display:block;
    color:#ccc;
    font-size:12px;
    margin-bottom:3px;
}

.setting input,
.setting select{
    width:100%;
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:6px;
    outline:none;
    font-size:13px;
}

/* الأزرار */
.btn{
    width:100%;
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:7px;
    font-size:13px;
    cursor:pointer;
    margin-bottom:6px;
}

.btn:hover{background:#191919}
.btn:active{opacity:.7}

.hidden{display:none}
</style>
</head>

<body>

<div id="toolbar">
    <button onclick="copyText()"><i class="fa-solid fa-copy"></i></button>
    <button onclick="cutText()"><i class="fa-solid fa-scissors"></i></button>
    <button onclick="pasteText()"><i class="fa-solid fa-paste"></i></button>
    <button onclick="clearAll()"><i class="fa-solid fa-trash"></i></button>
    <button onclick="undo()"><i class="fa-solid fa-rotate-left"></i></button>
    <button onclick="redo()"><i class="fa-solid fa-rotate-right"></i></button>
    <button onclick="goStart()"><i class="fa-solid fa-angles-up"></i></button>
    <button onclick="goEnd()"><i class="fa-solid fa-angles-down"></i></button>
    <button onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
</div>

<textarea id="editor"></textarea>

<div id="overlay"></div>

<div id="settingsBox">
<header>
    <button onclick="closeSettings()"><i class="fa-solid fa-xmark"></i></button>
</header>

<div class="setting">
    <label>اسم الملف</label>
    <input id="fileName" value="index.html">
</div>
<button class="btn" onclick="exportCode()">تصدير الكود كملف</button>

<button class="btn" onclick="fileInput.click()">استيراد من ملف</button>
<input id="fileInput" type="file" class="hidden">

<div class="setting">
    <label>رابط الملف</label>
    <input id="fileUrl" placeholder="https://example.com/file.txt">
</div>
<button class="btn" onclick="importFromUrl()">استيراد من رابط</button>

<button class="btn" onclick="runCode()">تشغيل الكود</button>

<div class="divider"></div>

<div class="setting">
    <label>لون النص</label>
    <input id="textColor">
</div>

<div class="setting">
    <label>لون الخلفية</label>
    <input id="bgColor">
</div>

<div class="setting">
    <label>حجم الخط</label>
    <input id="fontSize">
</div>

<div class="setting">
    <label>نوع الخط</label>
    <select id="fontFamily">
        <option value="system-ui">عادي</option>
        <option value="monospace">Monospace</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Verdana">Verdana</option>
        <option value="Courier New">Courier New</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Georgia">Georgia</option>
        <option value="Segoe UI">Segoe UI</option>
        <option value="sans-serif">Sans-serif</option>
    </select>
</div>
</div>

<script>
const editor=document.getElementById("editor");
const overlay=document.getElementById("overlay");
const settingsBox=document.getElementById("settingsBox");

const fileInput=document.getElementById("fileInput");
const fileName=document.getElementById("fileName");
const fileUrl=document.getElementById("fileUrl");

const textColor=document.getElementById("textColor");
const bgColor=document.getElementById("bgColor");
const fontSize=document.getElementById("fontSize");
const fontFamily=document.getElementById("fontFamily");

const CODE_KEY="saved_code";
const SETTINGS_KEY="editor_settings";

/* استرجاع */
editor.value=localStorage.getItem(CODE_KEY)||"";
editor.addEventListener("input",()=>localStorage.setItem(CODE_KEY,editor.value));

/* الإعدادات */
const editorSettings={color:"#fff",bg:"#000",size:"15px",font:"system-ui"};
Object.assign(editorSettings,JSON.parse(localStorage.getItem(SETTINGS_KEY)||"{}"));
applySettings();

function applySettings(){
    editor.style.color=editorSettings.color;
    editor.style.background=editorSettings.bg;
    editor.style.fontSize=editorSettings.size;
    editor.style.fontFamily=editorSettings.font;

    textColor.value=editorSettings.color;
    bgColor.value=editorSettings.bg;
    fontSize.value=editorSettings.size;
    fontFamily.value=editorSettings.font;

    localStorage.setItem(SETTINGS_KEY,JSON.stringify(editorSettings));
}

textColor.oninput=()=>{editorSettings.color=textColor.value;applySettings();}
bgColor.oninput=()=>{editorSettings.bg=bgColor.value;applySettings();}
fontSize.oninput=()=>{editorSettings.size=fontSize.value;applySettings();}
fontFamily.onchange=()=>{editorSettings.font=fontFamily.value;applySettings();}

/* نافذة */
function openSettings(){overlay.style.display="block";settingsBox.style.display="block";}
function closeSettings(){overlay.style.display="none";settingsBox.style.display="none";}

/* أدوات */
function hasSel(){return editor.selectionStart!==editor.selectionEnd}

function copyText(){
    const t=hasSel()?editor.value.substring(editor.selectionStart,editor.selectionEnd):editor.value;
    navigator.clipboard.writeText(t);
}

function cutText(){
    if(hasSel()){
        const s=editor.selectionStart,e=editor.selectionEnd;
        navigator.clipboard.writeText(editor.value.substring(s,e));
        editor.setRangeText("",s,e,"start");
    }else{
        navigator.clipboard.writeText(editor.value);
        editor.value="";
    }
    localStorage.setItem(CODE_KEY,editor.value);
}

async function pasteText(){
    try{
        const text=await navigator.clipboard.readText();
        const s=editor.selectionStart;
        editor.setRangeText(text,s,s,"end");
        localStorage.setItem(CODE_KEY,editor.value);
    }catch(e){}
}

function clearAll(){editor.value="";localStorage.setItem(CODE_KEY,"")}
function undo(){document.execCommand("undo")}
function redo(){document.execCommand("redo")}
function goStart(){editor.focus();editor.setSelectionRange(0,0)}
function goEnd(){editor.focus();editor.setSelectionRange(editor.value.length,editor.value.length)}

/* تصدير */
function exportCode(){
    const blob=new Blob([editor.value],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=fileName.value||"index.html";
    a.click();
    URL.revokeObjectURL(a.href);
}

/* استيراد ملف */
fileInput.onchange=()=>{
    const f=fileInput.files[0];
    if(!f)return;
    const r=new FileReader();
    r.onload=e=>{
        editor.value=e.target.result;
        localStorage.setItem(CODE_KEY,editor.value);
    };
    r.readAsText(f);
};

/* استيراد من رابط */
function importFromUrl(){
    fetch(fileUrl.value)
        .then(r=>r.text())
        .then(t=>{
            editor.value=t;
            localStorage.setItem(CODE_KEY,editor.value);
        });
}

/* تشغيل في نفس النافذة */
function runCode(){
    const blob=new Blob([editor.value],{type:"text/html"});
    const url=URL.createObjectURL(blob);
    window.location.href=url;
}
</script>

</body>
</html>
